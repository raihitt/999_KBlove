# 04: 再構築・リファクタリング履歴 (History)

このドキュメントは、2026年2月に実施した keymap および AML 挙動の大幅改善に関する記録をまとめたものです。

---

## Stage 1: 参照エビデンス
改善のベースラインとして、外部の `monokey.keymap` 実装を参考にしました。

### 確認された主要要素
- `quick-tap-ms = <300>` によるタップホールドの安定化
- 同時押しによるマウス操作導線の短縮 (`bindings = <&mo 5>;` / `key-positions = <17 18>;` 等)
- 空レイヤー (layer_7〜11) の予約

---

## Stage 2: 比較判断とポリシー
`tomkey` への移植に際し、以下のポリシーを策定しました。

1. **固有値ポリシー**: `MOUSE` / `SCROLL` 等のレイヤー番号は `tomkey` 既存構成を正とし、安易に変更しない。
2. **反映方針**: 低リスクな `quick-tap-ms` 調整から順次適用し、最後にコンボ等の配置最適化を行う。

---

## Stage 3: 再構築・検証手順
以下のフローで変更を適用しました。

1. **前提確認**: `docs/aml/` の依存関係を確認。
2. **最小差分反映**: 1コミット1目的で `config/tomkey.keymap` を編集。
3. **実機検証ポイント**:
   - 通常タイピング時に意図しないホールド判定が出ないか。
   - マウス移動中のクリック/スクロール維持が安定しているか (AML `excluded-positions` の確認)。
   - 縦スクロール専用コンボで横揺れが抑制されているか。
